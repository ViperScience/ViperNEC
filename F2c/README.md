# Generating NEC2 C code using F2c #
The following steps were taken to convert the FORTRAN code contained in nec2dxs.f to c using the F2c conversion tool. The organization of this project is summarized in the table below.

| Item | Description |
|------|-------------|
| src/ | F2c source code from netlib |
| doc/ | F2c documentation |
| nec2dxs/| FORTRAN version of NEC2 converted |
| c/    | NEC2 C code produced by the conversion |
| c/libf2c/ | F2c library required to compile the converted c code |
| run_f2c.sh | Shell script used to perform the NEC2 conversion |

## Building F2c ##

The source code for F2c is contained in the `src` directory. The program is first built from source prior to use.

Per the F2c instructions, a copy of `makefile.u` was made and named to just `makefile`. Since the compilation was run on macOS, the makefile was modified to use the GCC compiler installed via homebrew by changing `CC = cc` to `CC = gcc-8` (GCC v8.2.0). Then the program was built using `make`. This generates a binary called `f2c` in the `src` directory.

## Running F2c ##

The script `run_f2c.sh` contains the command used to run the conversion of the NEC2 code. Note that the directory `c/libf2c/` contains the F2c library that is required in order to compile the converted c code. Some of the origianl header files in libf2c had .h0 extensions so gcc wouldn't find them.

## Building the F2c library

The code generated by the F2c conversion must be linked to the F2c library when compiled in order to run. The library files are located in `c/libf2c/`. The file `makefile.u` was copied to `makefile` and the line `CC = cc` was changed to `CC = gcc-8` (GCC v8.2.0). Then the program was built using `make`. This generates a static library `libf2c.a`.

## Compiling the generated C code

A makefile was created in `c/` to compile code in `nec2dxs.c` generated by the F2c conversion process. In summary the code must be compiled against the library built in the previous steps and the `libf2c` folder must be added as an include directory (for header files).

One additional step, the timing functions built into the original code were platform dependent and taken out in subsequent versions in favor of intrinsic functions provided by the FORTRAN compiler (see the function `SECOND` in the FROTRAN code). The F2c conversion did not take this into account. Therefore, a small function `second_.c` was written and included in the `c/` directory. The `nec2dxs.c` code must be linked with this in order to compile. 
